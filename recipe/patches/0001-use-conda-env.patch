From 890d78f5393a33704cb4c7c4d14638a7bbe714c6 Mon Sep 17 00:00:00 2001
From: Eric Lundby <Eric.Lundby@gmail.com>
Date: Thu, 9 Oct 2025 09:27:02 -0600
Subject: [PATCH 1/1] use-conda-env

df
---
 ffi/build.py | 21 ++++++++++++++++++++-
 1 file changed, 20 insertions(+), 1 deletion(-)

diff --git a/ffi/build.py b/ffi/build.py
index 779471e..5a64ac9 100755
--- a/ffi/build.py
+++ b/ffi/build.py
@@ -7,6 +7,7 @@ from __future__ import print_function
 
 import os
 import subprocess
+import shlex
 import shutil
 import sys
 import tempfile
@@ -32,6 +33,9 @@ def env_var_options_to_cmake_options():
     # driven toolchain.
     cmake_options = []
 
+    cmake_options += shlex.split(os.environ.get("CMAKE_ARGS", ""))
+
     env_vars = {"LLVMLITE_PACKAGE_FORMAT": ("conda", "wheel"),
                 "LLVMLITE_USE_RTTI": ("ON", "OFF", ""),
                 "LLVMLITE_CXX_STATIC_LINK": bool,
@@ -167,7 +171,22 @@ def main_windows():
     # Run configuration step
     try_cmake(here_dir, build_dir, *generator)
     subprocess.check_call(['cmake', '--build', build_dir, '--config', config])
-    shutil.copy(os.path.join(build_dir, config, 'llvmlite.dll'), target_dir)
+    
+    # Find the DLL file - it might be in different locations depending on generator
+    dll_paths = [
+        os.path.join(build_dir, config, 'llvmlite.dll'),  # Visual Studio
+        os.path.join(build_dir, 'llvmlite.dll'),          # Ninja
+    ]
+    
+    for dll_path in dll_paths:
+        if os.path.exists(dll_path):
+            shutil.copy(dll_path, target_dir)
+            break
+    else:
+        raise RuntimeError(f"Could not find llvmlite.dll in any expected location: {dll_paths}")
 
 
 def main_posix(library_ext):
-- 
2.45.2

